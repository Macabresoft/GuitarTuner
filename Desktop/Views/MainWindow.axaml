<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:Macabresoft.GuitarTuner.Desktop.Converters"
        xmlns:viewModels="clr-namespace:Macabresoft.GuitarTuner.Desktop.ViewModels"
        x:Class="Macabresoft.GuitarTuner.Desktop.Views.MainWindow"
        Name="_mainWindow"
        Icon="/icon.ico"
        Width="420"
        MinWidth="256"
        CanResize="False"
        Title="Guitar Tuner by Macabresoft">
	<Window.Resources>
		<converters:EqualsConverter x:Key="EqualsConverter" />
	</Window.Resources>
	<Design.DataContext>
		<viewModels:MainWindowViewModel />
	</Design.DataContext>
	<Grid RowDefinitions="Auto, Auto, Auto, Auto"
	      Background="{StaticResource BackgroundBrush}">
		<Menu Grid.Row="0">
			<MenuItem Header="File">
				<MenuItem Click="Exit_Click"
                          Header="_Exit" />
			</MenuItem>
			
			<MenuItem Header="Devices"
			          Items="{Binding AvailableDevices}">
				<MenuItem.Styles>
					<Style Selector="MenuItem MenuItem">
						<Setter Property="Header" 
						        Value="{Binding}" />
						<Setter Property="Icon">
							<Setter.Value>
								<Template>
								<TextBlock VerticalAlignment="Center"
								           HorizontalAlignment="Center"
								           Margin="0"
								           Padding="0"
								           Text="●">
									<TextBlock.IsVisible>
										<MultiBinding Converter="{StaticResource EqualsConverter}">
											<Binding Path="$parent[MenuItem].Header" />
											<Binding Path="#_mainWindow.DataContext.SelectedDevice" />
										</MultiBinding>
									</TextBlock.IsVisible>
								</TextBlock>
								</Template>
							</Setter.Value>
						</Setter>
						<Setter Property="Command" 
						        Value="{Binding #_mainWindow.DataContext.SelectDeviceCommand}" />
						<Setter Property="CommandParameter" 
						        Value="{Binding}"  />
					</Style>
				</MenuItem.Styles>
			</MenuItem>
			
			<MenuItem Header="Help">
				<MenuItem Click="ViewSource_Click"
                          Header="View _Source" />
			</MenuItem>
		</Menu>
		
		<Grid Grid.Row="1"
		      Height="128"
		      ColumnDefinitions="Auto, *, Auto">

			<TextBlock Grid.Column="0"
			           Text="♭"
			           FontSize="24"
			           TextAlignment="Left"
			           VerticalAlignment="Bottom"/>

			<TextBlock Grid.Column="1"
			           Foreground="{StaticResource ForegroundBrush}"
			           Text="{Binding Note.Name}"
			           FontSize="48"
			           TextAlignment="Center"
			           VerticalAlignment="Bottom"/>

			<TextBlock Grid.Column="2"
			           Text="♯"
			           FontSize="24"
			           TextAlignment="Right"
			           VerticalAlignment="Bottom"/>
		</Grid>
		
		<Border Grid.Row="2"
		        BorderBrush="{StaticResource ForegroundBrush}"
		        BorderThickness="0 1 0 1">
			<Canvas Height="32" 
			        HorizontalAlignment="Stretch">
				<Line Canvas.Top="15"
				      StartPoint="{Binding $parent.Bounds.TopLeft}"
				      EndPoint="{Binding $parent.Bounds.TopRight}"
				      Stroke="{StaticResource ForegroundBrush}"
				      StrokeThickness="1" />
				<Line Name="_needle"
				      Height="32"
				      Stroke="{StaticResource HighlightBrush}"
				      StrokeThickness="3" />
			</Canvas>
		</Border>

		<TextBlock Grid.Row="3"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Foreground="{StaticResource ForegroundBrush}"
                   Text="{Binding Frequency, Mode=OneWay, StringFormat={}{0:n} Hz}" />
	</Grid>
</Window>